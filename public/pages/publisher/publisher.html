<!doctype html>
<html>
<head>

</head>
<body>
<div id="local-container" style="width:400px; height: 400px"></div>
<script src="https://cdn.agora.io/sdk/web/AgoraRTCSDK-2.6.0.js"></script>
<script>
    var cname = "ycy_wishing_machine";

    var codecs = ["h264", "vp8"];
    codecs.forEach(function(codec){
        var client = AgoraRTC.createClient({mode: "rtc", codec: codec});
        client.init("b7db71a6d9724c3f940cbcddcbd2b09d", function () {
            client.join(null, cname + "_" + codec, 8888, function(){
                console.log("Client joined");
                const spec = {video: true, audio: true};
                const localStream = AgoraRTC.createStream(spec);
                localStream.setVideoProfile("720p_2");
                spec.video = {
                    width: 720,
                    height: 720,
                };
                console.log("spec", spec);
                localStream.init(function(){
                    window.vt = localStream.stream.getVideoTracks()[0]
                    console.log("LocalStream Inited");
                    client.publish(localStream);
                    client.on("stream-published", function(){
                        console.log("stream published");
                        localStream.play("local-container");
                        localStream.audioMixing.inEarMonitoring = "NONE";
                        if (codec === "vp8"){
                            localStream.startAudioMixing({
                                filePath: '/music/kll.mp3',
                                replace: true,
                                playTime: 0,
                                loop: true
                            });
                        }else{
                            localStream.startAudioMixing({
                                filePath: '/music/pickme.mp4',
                                replace: true,
                                playTime: 0,
                                loop: true
                            });
                        }
                    });
                });
            });
        });
    });
</script>
</body>
</html>