<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
    <script src="https://cdn.agora.io/sdk/web/AgoraRTCSDK-2.6.1.js"></script>
    <script src="../../vendor/eruda.js"></script>
</head>
<body style="margin: 0;">
<div id="video-container"></div>
<div class="input-group mb-3">
    <input id="textMessage" type="text" class="form-control" placeholder="来许愿吧！" aria-label="来许愿吧！" aria-describedby="sendMessage">
    <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" id="sendMessage" onclick="sendTextMessage()">发射！</button>
    </div>
</div>
<br/>
<br/>
<br/>
<br/>
<br/>
<h5>开发日志</h5>
<ul class="list-group list-group-flush">
    <li class="list-group-item">v1.0.0 2019年04月11日 咕咕鸡文字API对接完成！</li>
    <li  class="list-group-item">v0.9.0 2019年04月10日 视频直播完成！</li>
</ul>
<script>
    eruda.init();
    AgoraRTC.getSupportedCodec().then(console.log);
</script>
<script>
    var client = AgoraRTC.createClient({mode: "rtc", codec: "vp8"});
    client.init("b7db71a6d9724c3f940cbcddcbd2b09d", function () {
        client.join(null, "ycy_wishing_machine", null, function(){
            console.log("Client joined");
            client.on("stream-added", function(evt){
                console.log("stream-added", evt);
                if (evt.stream.getId() === 1111){
                    console.log("Subscribing stream", evt.stream.getId());
                    client.subscribe(evt.stream);
                }
            });
            client.on("stream-subscribed", function(evt){
                console.log("stream subscribed", evt.stream);
                // document.getElementById("remote-container").innerHTML = "";
                // evt.stream.play("remote-container", {muted: true, controls: true});
                const elem = document.createElement('video');
                elem.srcObject = evt.stream.stream;
                elem.muted = true;
                elem.setAttribute("muted", "muted");
                elem.setAttribute("playsinline", "playsinline");
                elem.setAttribute("style", "width: 100%");
                const container = document.getElementById("video-container");
                container.innerHTML = "";
                container.appendChild(elem);
                elem.play().then(function(){
                    console.log("elem play success");
                }).catch(function (err) {
                    console.error("elem play error", err.error, err.message, err.info, err);
                    elem.setAttribute("controls", "");
                });
            });
        });
    });
</script>
<script>
function sendTextMessage(){
    var elem = document.getElementById("textMessage")
    var text = elem.value;
    axios.post("/api/memobird/text", {text: text}).then(function(resp){
        console.log(resp);
        elem.value = "";
    });
};
</script>
</body>
</html>