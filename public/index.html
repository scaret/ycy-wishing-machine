<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>杨超越许愿咕咕鸡 - 杨超越编程大赛45号作品</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootbox.js/4.3.0/bootbox.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>
    <script src="https://cdn.agora.io/sdk/web/AgoraRTCSDK-2.6.1.js"></script>
    <link href="https://cdn.bootcss.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">
    <!--    <script src="https://cdn.bootcss.com/eruda/1.5.4/eruda.min.js"></script>-->
    <script src="pages/subscriber/sendMessage.js"></script>
</head>
<body style="margin: 0;">
<div id="video-container"></div>

<div class="container">
    <div class="row" style="text-align: center;">
        <div class="col modal-control" data-toggle="modal" data-target="#sendTextModal">
            <h1><i class="fas fa-comment-alt" style="color: #1AAD19;"></i></h1>
        </div>
        <!--        <div class="col">-->
        <!--            <h1><i class="fas fa-camera" style="color: #6495ed"></i></h1>-->
        <!--        </div>-->
        <div class="col modal-control" data-toggle="modal" data-target="#aboutModal">
            <h1><i class="fas fa-info-circle" style="color: #e0a800"></i></h1>
        </div>
    </div>
</div>
<!--<div class="input-group mb-3">-->
<!--    <input id="textMessage" type="text" class="form-control" placeholder="来许愿吧！" aria-label="来许愿吧！" aria-describedby="sendMessage">-->
<!--    <div class="input-group-append">-->
<!--        <button class="btn btn-outline-secondary" type="button" id="sendMessage" onclick="sendTextMessage()">发射！</button>-->
<!--    </div>-->
<!--</div>-->
<br/>

<!-- 文字许愿 -->
<div id="sendTextModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">文字许愿</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>向锦鲤超越许个愿吧~(建议三行左右哦)</p>
                <textarea class="form-control" id="textMessage" placeholder="我希望————" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">先不要</button>
                <button type="button" class="btn btn-primary" onclick="sendTextMessage()">发射~</button>
            </div>
        </div>
    </div>
</div>

<!-- 关于 -->
<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">关于</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h5>关于本作品</h5>
                <p>本作品是<a href="https://github.com/ccyyycy/ycy">杨超越编程大赛</a>
                    的
                    <a href="https://github.com/ccyyycy/ycy/issues/309">第45号作品。</a>
                </p>
                <p>希望超越可以给大家带来好运！</p>
                <p><img src="img/ycy.jpg" style="width: 100%"></p>
                <h5>关于我</h5>
                <p>程序员一枚。坐标上海。全栈。</p>
                <p><a href="https://github.com/scaret">这是我的Github</a></p>
                <p>如果有什么建议可以发送电子邮件到 scaret.in@gmail.com</p>
                <h5>开发日志</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">v1.0.1 2019年04月12日 用户昵称（半夜爬起来换纸）</li>
                    <li class="list-group-item">v1.0.0 2019年04月11日 咕咕鸡文字API对接完成！</li>
                    <li  class="list-group-item">v0.9.0 2019年04月10日 视频直播完成！</li>
                </ul>
                <p>如果您喜欢本作品，可以给我买杯咖啡。我看到后会转回3.3元给您，表示感谢~以下是支付宝二维码</p>
                <p><img src="img/alipay.jpg" style="width: 100%;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<script>
    // eruda.init();
    AgoraRTC.getSupportedCodec().then(console.log);
</script>
<script>
    const elem = document.createElement('video');
    elem.muted = true;
    elem.setAttribute("muted", "muted");
    elem.setAttribute("playsinline", "playsinline");
    elem.setAttribute("style", "width: 100%");
    const container = document.getElementById("video-container");
    container.innerHTML = "";
    container.appendChild(elem);

    var cname = "ycy_wishing_machine";
    var codec = "vp8";
    AgoraRTC.getSupportedCodec().then(function(codecs){
        console.log("codecs", codecs);
        if (codecs.video.indexOf("VP8" !== -1)){
            codec = "vp8";
        }else{
            codec = "h264";
        }
        main();
    });

    function main(){
        var client = AgoraRTC.createClient({mode: "rtc", codec: "vp8"});
        client.init("b7db71a6d9724c3f940cbcddcbd2b09d", function () {
            client.join(null, cname + "_" + codec, null, function(){
                console.log("Client joined");
                client.on("stream-added", function(evt){
                    console.log("stream-added", evt);
                    if (evt.stream.getId() === 8888){
                        console.log("Subscribing stream", evt.stream.getId());
                        client.subscribe(evt.stream);
                    }
                });
                client.on("stream-subscribed", function(evt){
                    console.log("stream subscribed", evt.stream);
                    // document.getElementById("remote-container").innerHTML = "";
                    // evt.stream.play("remote-container", {muted: true, controls: true});
                    elem.srcObject = evt.stream.stream;
                    elem.play().then(function(){
                        console.log("elem play success");
                    }).catch(function (err) {
                        console.error("elem play error", err.error, err.message, err.info, err);
                        elem.setAttribute("controls", "");
                    });
                });
            });
        });
    }

</script>
<script>
    var nickname = window.localStorage && localStorage.getItem("nickname");
    function updateNickname(){
        bootbox.prompt({
            closeButton: false,
            title: "你的名字是？",
            callback: function(result){
                if (result){
                    nickname = result;
                    window.localStorage && localStorage.setItem("nickname", nickname);
                }else{
                    updateNickname();
                }
                elem.play();
            }
        });
    }
    function confirmNickname(){
        bootbox.confirm({
            closeButton: false,
            message: `你好，${nickname}`,
            buttons:{
                confirm: {
                    label: "是我",
                },
                cancel: {
                    label: "不是我"
                },
            },
            callback: function(result){
                if (!result){
                    updateNickname();
                }
                elem.play();
            }
        });
    }
    if(!nickname){
        updateNickname();
    }else{
        confirmNickname();
    }
    $(".modal-control").on("click", function(){
        console.log("modal-control")
    })

</script>
</body>
</html>